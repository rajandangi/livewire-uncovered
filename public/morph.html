<!-- On page : -->
<ul>
    <li>foo</li>
    <li>fooo</li>
    <li>fooo</li>
    <li>fooo</li>
</ul>

<!-- From Server -->
<ul>
    <li>bar</li>
    <li>barr</li>
    <li>barrr</li>
</ul>

</br>
</br>
<button onclick="morph(document.body.children[0],document.body.children[1].outerHTML)">Morph</button>

<script>
    function morph(from, to) {
        if (typeof to === 'string') {
            let temp = document.createElement('div');
            temp.innerHTML = to;
            to = temp.firstElementChild;
        }

        if (from.tagName !== to.tagName) {
            from.replaceWith(to.cloneNode(true));
        }

        patchText(from, to);
        patchAttributes(from, to);
        patchChildren(from, to);
    }

    function patchChildren(from, to) {
        let childFrom = from.firstElementChild;
        let childTo = to.firstElementChild;

        // If there are more children in the to node, add them
        while (childTo) {
            if (!childFrom) {
                childFrom = from.appendChild(childTo.cloneNode(true));
            } else {
                morph(childFrom, childTo);
            }

            childFrom = childFrom.nextElementSibling;
            childTo = childTo.nextElementSibling;
        }

        // If there are more children in the from node, remove them
        while (childFrom) {
            let toRemove = childFrom;
            childFrom = childFrom.nextElementsibling;
            toRemove.remove();
        }
    }

    function patchAttributes(from, to) {
        // for (let attributes of to.attributes) {
        //     from.setAttribute(attributes.name, attributes.value);
        // }
        for (let { name, value } of to.attributes) {
            from.setAttribute(name, value);
        }

        for (let { name, value } of from.attributes) {
            if (!to.hasAttribute(name)) {
                from.removeAttribute(name)
            }
        }
    }

    function patchText(from, to) {
        if (to.children.length > 0) return;
        from.textContent = to.textContent;
    }
</script>